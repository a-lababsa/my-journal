<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode | default "fr" }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {{- $title := cond .IsHome .Site.Title (printf "%s - %s" .Title .Site.Title) -}}
    {{- $description := cond (ne .Description "") .Description .Site.Params.description -}}
    {{- $url := .Permalink -}}
    {{- $image := printf "%s%s" .Site.BaseURL "images/og-default.png" -}}

    <title>{{ $title }}</title>

    <!-- SEO de base -->
    <meta name="description" content="{{ $description }}">
    <meta name="keywords" content="{{ if .Keywords }}{{ delimit .Keywords "," }}{{ else }}{{ delimit .Site.Params.keywords "," }}{{ end }}">
    <meta name="author" content="{{ .Site.Params.author }}">
    <link rel="canonical" href="{{ $url }}">

    <!-- Open Graph (partage rÃ©seaux sociaux, iMessage, Slackâ€¦) -->
    <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
    <meta property="og:title" content="{{ $title }}">
    <meta property="og:description" content="{{ $description }}">
    <meta property="og:url" content="{{ $url }}">
    <meta property="og:site_name" content="{{ .Site.Title }}">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:image" content="{{ $image }}">
    {{- if .IsPage }}
    <meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
    <meta property="article:author" content="{{ .Site.Params.author }}">
    {{- end }}

    <!-- Twitter / X Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="{{ $title }}">
    <meta name="twitter:description" content="{{ $description }}">
    <meta name="twitter:image" content="{{ $image }}">

    <!-- Couleur de la barre du navigateur sur mobile -->
    <meta name="theme-color" content="#F5F1E6" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#2a2a2a" media="(prefers-color-scheme: dark)">

    <!-- JSON-LD : donnÃ©es structurÃ©es pour Google -->
    {{- if .IsPage }}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": {{ .Title | jsonify }},
        "description": {{ $description | jsonify }},
        "url": {{ $url | jsonify }},
        "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
        "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
        "author": {
            "@type": "Person",
            "name": {{ .Site.Params.author | jsonify }},
            "url": {{ (printf "%s%s" .Site.BaseURL "a-propos/") | jsonify }}
        },
        "publisher": {
            "@type": "Person",
            "name": {{ .Site.Params.author | jsonify }}
        },
        "inLanguage": "fr-FR"
    }
    </script>
    {{- else }}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": {{ .Site.Title | jsonify }},
        "description": {{ $description | jsonify }},
        "url": {{ .Site.BaseURL | jsonify }},
        "author": {
            "@type": "Person",
            "name": {{ .Site.Params.author | jsonify }}
        },
        "inLanguage": "fr-FR"
    }
    </script>
    {{- end }}

    <!-- PrÃ©vention du flash FOUC pour les modes sombre et dys -->
    <script>
        (function() {
            if (localStorage.getItem('tired-mode') === 'true') {
                document.documentElement.classList.add('tired-mode');
            }
            if (localStorage.getItem('dys-mode') === 'true') {
                document.documentElement.classList.add('dys-mode');
            }
        })();
    </script>

    <!-- Fonts : preconnect + display=swap pour ne pas bloquer le rendu -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400&family=Merriweather:ital,wght@0,400;0,500;1,400&family=Lora:ital,wght@0,400;0,500;1,400&family=Caveat:wght@400;500;600&display=swap" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400&family=Merriweather:ital,wght@0,400;0,500;1,400&family=Lora:ital,wght@0,400;0,500;1,400&family=Caveat:wght@400;500;600&display=swap">
    </noscript>

    <link rel="stylesheet" href="{{ "css/style.css" | relURL }}">

    {{ with .Site.Params.customCss }}
        {{ range . }}
            <link rel="stylesheet" href="{{ . | relURL }}">
        {{ end }}
    {{ end }}
</head>
<body>
    <a href="#main-content" class="skip-link">Aller au contenu principal</a>

    <div class="container">
        <header class="site-header" role="banner">
            <p class="site-title">
                <a href="{{ .Site.BaseURL }}">{{ .Site.Title }}</a>
            </p>
            <nav class="site-nav" aria-label="Navigation principale">
                <a href="{{ .Site.BaseURL }}" class="nav-link{{ if .IsHome }} nav-link--active{{ end }}"
                   {{- if .IsHome }} aria-current="page"{{ end }}>Accueil</a>
                {{- $currentURL := .RelPermalink -}}
                {{- range .Site.Menus.main -}}
                {{- $active := hasPrefix $currentURL (.URL | relURL) -}}
                <a href="{{ .URL | relURL }}" class="nav-link{{ if $active }} nav-link--active{{ end }}"
                   {{- if $active }} aria-current="page"{{ end }}>{{ .Name }}</a>
                {{- end -}}
            </nav>
        </header>

        <main class="main-content" id="main-content" tabindex="-1">
            {{ block "main" . }}{{ end }}
        </main>

        <footer class="site-footer" role="contentinfo">
            <div class="footer-controls" aria-label="Options d'affichage">
                <button class="mode-toggle" id="tired-mode-btn"
                        aria-pressed="false"
                        aria-label="Activer le mode sombre">
                    ðŸŒ™
                </button>
                <button class="mode-toggle dys-toggle" id="dys-mode-btn"
                        aria-pressed="false"
                        aria-label="Activer le mode dyslexie â€” police et espacement adaptÃ©s">
                    Aa
                </button>
            </div>
            <div class="footer-meta">
                {{- $lastPost := first 1 (where .Site.RegularPages "Section" "posts") -}}
                {{- with index $lastPost 0 }}
                <span class="footer-last-entry">DerniÃ¨re entrÃ©e : {{ .Date.Format "2 janvier 2006" }}</span>
                {{- end }}
                <a href="{{ "/index.xml" | relURL }}" class="footer-rss" aria-label="Flux RSS â€” s'abonner au journal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                        <path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19.01 7.38 20 6.18 20C4.98 20 4 19.01 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/>
                    </svg>
                    RSS
                </a>
            </div>
        </footer>
    </div>

    <script src="{{ "js/intimate-reading.js" | relURL }}"></script>

    {{ with .Site.Params.customJs }}
        {{ range . }}
            <script src="{{ . | relURL }}"></script>
        {{ end }}
    {{ end }}
</body>
</html>
